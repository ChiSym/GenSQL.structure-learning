schema: '2.0'
stages:
  subsample:
    cmd: "mkdir -p data/test && python scripts/subsample.py --data data/data.csv --test-data-dir
      data/test --params params.yaml --output data/subsampled.csv\n"
    deps:
    - path: data/data.csv
      hash: md5
      md5: 5e50e6df7a105654b603a0679190d485
      size: 26314061
    - path: scripts/subsample.py
      hash: md5
      md5: e984c015340dc2e50d926b4e3931b9dd
      size: 1821
    params:
      params.yaml:
        seed: 110
        sub_sample:
          N: 30000
    outs:
    - path: data/subsampled.csv
      hash: md5
      md5: 488a31292fb5f2c3218e358c44770a63
      size: 21232125
    - path: data/test
      hash: md5
      md5: 42ca76674f512ab14ab38305a0ebc7a4.dir
      size: 5095862
      nfiles: 2
  validate-column-names:
    cmd: bin/validate.sh
    deps:
    - path: data/subsampled.csv
      hash: md5
      md5: 488a31292fb5f2c3218e358c44770a63
      size: 21232125
    outs:
    - path: data/validated.csv
      hash: md5
      md5: 488a31292fb5f2c3218e358c44770a63
      size: 21232125
  nullify:
    cmd: "clojure -X gensql.structure-learning.main/nullify < data/validated.csv >
      data/nullified.csv\n"
    deps:
    - path: data/validated.csv
      hash: md5
      md5: 488a31292fb5f2c3218e358c44770a63
      size: 21232125
    params:
      params.yaml:
        nullify:
    outs:
    - path: data/nullified.csv
      hash: md5
      md5: 488a31292fb5f2c3218e358c44770a63
      size: 21232125
  guess-schema:
    cmd: "clojure -X gensql.structure-learning.main/guess-schema < data/nullified.csv
      > data/schema.edn\n"
    deps:
    - path: data/nullified.csv
      hash: md5
      md5: 488a31292fb5f2c3218e358c44770a63
      size: 21232125
    params:
      params.yaml:
        schema:
          _target_date: ignore
          id: ignore
          restaurant_URL: ignore
          name: ignore
          head_branch: ignore
          area1_name: ignore
          area2_name: ignore
          area3_name: ignore
          zipcode: ignore
          station_name: ignore
          northlatitude: numerical
          eastlongitude: numerical
          created_at: numerical
          address: ignore
          address1: ignore
          address2: ignore
          business_hours: ignore
          holiday: ignore
          transportation: ignore
          tel_number: ignore
          reservation_tel_number: ignore
          card_status: ignore
          service_charge_flg: ignore
          service_charge_details: ignore
          seat_capacity: numerical
          total_score: numerical
          review_count: numerical
          hozon_count: numerical
          all_photo_count: numerical
          photo_food_count: numerical
          photo_drink_count: numerical
          photo_interior_count: numerical
          photo_exterior_count: numerical
          max_visit_month: numerical
          closed: nominal
    outs:
    - path: data/schema.edn
      hash: md5
      md5: 5f7ea940bbfc22ead94a9b1a17ff0d82
      size: 3002
  cgpm-schema:
    cmd: "clojure -X gensql.structure-learning.main/cgpm-schema < data/schema.edn
      > data/cgpm-schema.edn\n"
    deps:
    - path: data/schema.edn
      hash: md5
      md5: 5f7ea940bbfc22ead94a9b1a17ff0d82
      size: 3002
    outs:
    - path: data/cgpm-schema.edn
      hash: md5
      md5: dc669131209678543abc69709ca18ae4
      size: 2900
  ignore:
    cmd: "clojure -X gensql.structure-learning.main/ignore :schema '\"data/schema.edn\"\
      ' < data/nullified.csv > data/ignored.csv\n"
    deps:
    - path: data/nullified.csv
      hash: md5
      md5: 488a31292fb5f2c3218e358c44770a63
      size: 21232125
    - path: data/schema.edn
      hash: md5
      md5: 5f7ea940bbfc22ead94a9b1a17ff0d82
      size: 3002
    outs:
    - path: data/ignored.csv
      hash: md5
      md5: cf101b7e87a9ccd5135ff8f846f59302
      size: 9663462
  numericalize:
    cmd: "clojure -X gensql.structure-learning.main/numericalize :schema '\"data/schema.edn\"\
      ' :table data/mapping-table.edn < data/ignored.csv > data/numericalized.csv\n"
    deps:
    - path: data/ignored.csv
      hash: md5
      md5: cf101b7e87a9ccd5135ff8f846f59302
      size: 9663462
    - path: data/schema.edn
      hash: md5
      md5: 5f7ea940bbfc22ead94a9b1a17ff0d82
      size: 3002
    outs:
    - path: data/mapping-table.edn
      hash: md5
      md5: b63b4188dec52136d47953924a7222e5
      size: 16161
    - path: data/numericalized.csv
      hash: md5
      md5: e76bb612d3cc5e3fe032e38f47126d52
      size: 6570358
  loom-schema:
    cmd: "clojure -X gensql.structure-learning.main/loom-schema < data/schema.edn
      > data/loom-schema.json\n"
    deps:
    - path: data/schema.edn
      hash: md5
      md5: 5f7ea940bbfc22ead94a9b1a17ff0d82
      size: 3002
    outs:
    - path: data/loom-schema.json
      hash: md5
      md5: d38348f6d1d1e7a813a68652a21ec350
      size: 2042
  loom-ingest:
    cmd: ./bin/loom_task ingest loom data/loom-schema.json data/numericalized.csv
    deps:
    - path: data/loom-schema.json
      hash: md5
      md5: d38348f6d1d1e7a813a68652a21ec350
      size: 2042
    - path: data/numericalized.csv
      hash: md5
      md5: e76bb612d3cc5e3fe032e38f47126d52
      size: 6570358
    outs:
    - path: loom/ingest
      hash: md5
      md5: a8a718b9d1c82582e9ce99a9bb2a3fea.dir
      size: 3289098
      nfiles: 7
    - path: loom/query
      hash: md5
      md5: 1a8517996c42259fad6f18ff0e3aa7ef.dir
      size: 106
      nfiles: 1
  loom-infer-config:
    cmd: "clojure -X gensql.structure-learning.main/infer-config < params.yaml > data/infer-config.json\n"
    params:
      params.yaml:
        loom.extra_passes: 200
        seed: 110
    outs:
    - path: data/infer-config.json
      hash: md5
      md5: 717915a7e4ab2124eba4d694aaf7c3ea
      size: 44
  loom-infer:
    cmd: ./bin/loom_task infer loom 16 data/infer-config.json
    deps:
    - path: data/infer-config.json
      hash: md5
      md5: 717915a7e4ab2124eba4d694aaf7c3ea
      size: 44
    - path: loom/ingest
      hash: md5
      md5: a8a718b9d1c82582e9ce99a9bb2a3fea.dir
      size: 3289098
      nfiles: 7
    - path: loom/query
      hash: md5
      md5: 1a8517996c42259fad6f18ff0e3aa7ef.dir
      size: 106
      nfiles: 1
    params:
      params.yaml:
        sample_count: 16
    outs:
    - path: loom/samples
      hash: md5
      md5: 022c334160f835eb9b89ec316b174c07.dir
      size: 40798345
      nfiles: 260
  loom-dump-metadata:
    cmd: "mkdir -p data/cgpm/raw && find loom/samples -mindepth 1 -maxdepth 1 -type
      d | parallel --verbose ./bin/loom python scripts/loom_dump.py {} --output data/cgpm/raw/{/}.json\n"
    deps:
    - path: loom/samples
      hash: md5
      md5: 022c334160f835eb9b89ec316b174c07.dir
      size: 40798345
      nfiles: 260
    - path: scripts/loom_dump.py
      hash: md5
      md5: c43616fe12258e9314fe1b481a6971e8
      size: 1978
    params:
      params.yaml:
        parallel.flags: --verbose
    outs:
    - path: data/cgpm/raw
      hash: md5
      md5: 6e0015f8faaa362618b7e502310d8df0.dir
      size: 15417011
      nfiles: 16
  cgpm-hydrate-metadata:
    cmd: "find data/cgpm/raw -type f | parallel jsonschema --instance {} schemas/cgpm.json
      && mkdir -p data/cgpm/hydrated && rm -f data/cgpm/inf.log && find data/cgpm/raw
      -type f | sort | parallel --verbose 'python scripts/cgpm_hydrate.py --metadata
      {} --output data/cgpm/hydrated/{/} --data data/numericalized.csv --schema data/cgpm-schema.edn
      --mapping-table data/mapping-table.edn --seed $((110 + {#} - 1))'\n"
    deps:
    - path: data/cgpm-schema.edn
      hash: md5
      md5: dc669131209678543abc69709ca18ae4
      size: 2900
    - path: data/cgpm/raw
      hash: md5
      md5: 6e0015f8faaa362618b7e502310d8df0.dir
      size: 15417011
      nfiles: 16
    - path: data/mapping-table.edn
      hash: md5
      md5: b63b4188dec52136d47953924a7222e5
      size: 16161
    - path: data/numericalized.csv
      hash: md5
      md5: e76bb612d3cc5e3fe032e38f47126d52
      size: 6570358
    - path: schemas/cgpm.json
      hash: md5
      md5: 75fb21013e98a73e03fbe1ace14426f2
      size: 4039
    - path: scripts/cgpm_hydrate.py
      hash: md5
      md5: 0ad32ff550f8b45a3642bddf279c9664
      size: 2971
    params:
      params.yaml:
        parallel.flags: --verbose
        seed: 110
    outs:
    - path: data/cgpm/hydrated
      hash: md5
      md5: e44a48e6b2439b3e4d0b3cd264b4c6fe.dir
      size: 265240447
      nfiles: 16
  cgpm-infer-hyperparameters:
    cmd: "find data/cgpm/hydrated -type f | parallel jsonschema --instance {} schemas/cgpm.json
      && mkdir -p data/cgpm/complete && echo 6480 >> data/cgpm/inf.log && find data/cgpm/hydrated
      -type f | sort | parallel --verbose 'python scripts/cgpm_infer.py {} --kernel
      alpha --kernel view_alphas --kernel column_hypers --kernel rows --kernel columns
      --output data/cgpm/complete/{/} --data data/numericalized.csv --params params.yaml
      --seed $((110 + {#} - 1)) --minutes 6480' #--iterations 1\n"
    deps:
    - path: data/cgpm/hydrated
      hash: md5
      md5: e44a48e6b2439b3e4d0b3cd264b4c6fe.dir
      size: 265240447
      nfiles: 16
    - path: data/numericalized.csv
      hash: md5
      md5: e76bb612d3cc5e3fe032e38f47126d52
      size: 6570358
    - path: schemas/cgpm.json
      hash: md5
      md5: 75fb21013e98a73e03fbe1ace14426f2
      size: 4039
    - path: scripts/cgpm_infer.py
      hash: md5
      md5: 8c953870a8ac391bb77deeb105403131
      size: 4523
    params:
      params.yaml:
        cgpm:
          iterations: 1
          minutes: 6480
        parallel.flags: --verbose
        seed: 110
    outs:
    - path: data/cgpm/complete
      hash: md5
      md5: 3f2e570f11b9ecb0b6746806a020da9c.dir
      size: 268841255
      nfiles: 16
  save-dependencies:
    cmd: "find data/cgpm/complete -type f | sort | xargs python scripts/dep_prob.py
      --data data/numericalized.csv --output data/dep-prob.json\n"
    deps:
    - path: data/cgpm/complete
      hash: md5
      md5: 3f2e570f11b9ecb0b6746806a020da9c.dir
      size: 268841255
      nfiles: 16
    outs:
    - path: data/dep-prob.json
      hash: md5
      md5: d8f5431ad876280936b8d02a7aa866cf
      size: 213999
  save-max-number-views:
    cmd: "find data/cgpm/complete -type f | xargs python scripts/save_n_views.py >>
      data/max-number-views.txt\n"
    deps:
    - path: data/cgpm/complete
      hash: md5
      md5: 3f2e570f11b9ecb0b6746806a020da9c.dir
      size: 268841255
      nfiles: 16
    outs:
    - path: data/max-number-views.txt
      hash: md5
      md5: 6512bd43d9caa6e02c990b0a82652dca
      size: 2
  dep-prob-vl:
    cmd: "clojure -X gensql.structure-learning.heatmap/vega-lite :stats-path '\"data/dep-prob.json\"\
      ' :domain '[0.0 1.0]' :default 1.0 :name '\"crosscat\"' :scheme '\"blues\"'
      > data/dep-prob.vl.json\n"
    deps:
    - path: data/dep-prob.json
      hash: md5
      md5: d8f5431ad876280936b8d02a7aa866cf
      size: 213999
    - path: src/clojure/gensql/structure_learning/heatmap.clj
      hash: md5
      md5: 1a9cd1bb8a534431a3836ed066758616
      size: 7364
    outs:
    - path: data/dep-prob.vl.json
      hash: md5
      md5: 3416f19e1f863f7d63779e281ebc5a87
      size: 589681
  dep-prob-vg:
    cmd: "pnpm vl2vg < data/dep-prob.vl.json > data/dep-prob.vg.json\n"
    deps:
    - path: data/dep-prob.vl.json
      hash: md5
      md5: 3416f19e1f863f7d63779e281ebc5a87
      size: 589681
    outs:
    - path: data/dep-prob.vg.json
      hash: md5
      md5: f57782a9e6d18e690d4b16200c451e4e
      size: 589102
  dep-prob-svg:
    cmd: "pnpm vg2svg < data/dep-prob.vg.json > data/dep-prob.svg\n"
    deps:
    - path: data/dep-prob.vg.json
      hash: md5
      md5: f57782a9e6d18e690d4b16200c451e4e
      size: 589102
    outs:
    - path: data/dep-prob.svg
      hash: md5
      md5: 4f9e14899e4fbb9686ace45bdfe81c94
      size: 1705092
  save-linear-stats:
    cmd: "python scripts/linear_stats.py --data data/ignored.csv --schema data/schema.edn
      --output data/linear-stats.json\n"
    deps:
    - path: data/ignored.csv
      hash: md5
      md5: cf101b7e87a9ccd5135ff8f846f59302
      size: 9663462
    - path: data/schema.edn
      hash: md5
      md5: 5f7ea940bbfc22ead94a9b1a17ff0d82
      size: 3002
    - path: scripts/linear_stats.py
      hash: md5
      md5: d5ebd4d1195a949b7c66ea7b77447f11
      size: 4361
    outs:
    - path: data/linear-stats.json
      hash: md5
      md5: 5e50204f0ed722af479ff9a14d88522f
      size: 690076
  linear-stats-vl:
    cmd: "clojure -X gensql.structure-learning.heatmap/vega-lite :stats-path '\"data/linear-stats.json\"\
      ' :sort-path '\"data/dep-prob.json\"' :domain '[1.0 0.0]' :default 0.0 :name
      '\"statistics\"' :field '\"p-value\"' :scheme '\"oranges\"' > data/linear-stats.vl.json\n"
    deps:
    - path: data/dep-prob.json
      hash: md5
      md5: d8f5431ad876280936b8d02a7aa866cf
      size: 213999
    - path: data/linear-stats.json
      hash: md5
      md5: 5e50204f0ed722af479ff9a14d88522f
      size: 690076
    - path: src/clojure/gensql/structure_learning/heatmap.clj
      hash: md5
      md5: 1a9cd1bb8a534431a3836ed066758616
      size: 7364
    outs:
    - path: data/linear-stats.vl.json
      hash: md5
      md5: 0ca9bff7f9761e042a24003939c6f5b6
      size: 686276
  linear-stats-vg:
    cmd: "pnpm vl2vg < data/linear-stats.vl.json > data/linear-stats.vg.json\n"
    deps:
    - path: data/linear-stats.vl.json
      hash: md5
      md5: 0ca9bff7f9761e042a24003939c6f5b6
      size: 686276
    outs:
    - path: data/linear-stats.vg.json
      hash: md5
      md5: 637cbdfee4d84c769777c1ba6cff0366
      size: 690458
  linear-stats-svg:
    cmd: "pnpm vg2svg < data/linear-stats.vg.json > data/linear-stats.svg\n"
    deps:
    - path: data/linear-stats.vg.json
      hash: md5
      md5: 637cbdfee4d84c769777c1ba6cff0366
      size: 690458
    outs:
    - path: data/linear-stats.svg
      hash: md5
      md5: f62035e02b50da73d5747075ec20e238
      size: 1771153
  compare-dep-prob-with-linear:
    cmd: "python scripts/compare_deps.py --deps data/dep-prob.json --linear data/linear-stats.json
      >> data/qc-statistical-tests.txt\n"
    deps:
    - path: data/dep-prob.json
      hash: md5
      md5: d8f5431ad876280936b8d02a7aa866cf
      size: 213999
    - path: data/linear-stats.json
      hash: md5
      md5: 5e50204f0ed722af479ff9a14d88522f
      size: 690076
    outs:
    - path: data/qc-statistical-tests.txt
      hash: md5
      md5: 09773c4a14db36cf87381c0e1c07bee7
      size: 59490
  ast-export:
    cmd:
    - 'parallel --verbose jsonschema --instance {} schemas/cgpm.json :::: <(find data/cgpm/complete
      -type f)'
    - mkdir -p data/ast
    - "parallel --verbose 'python scripts/ast_export.py --metadata {} --data data/numericalized.csv
      --mapping-table data/mapping-table.edn --output data/ast/{/.}.edn' :::: <(find
      data/cgpm/complete -type f)"
    deps:
    - path: data/cgpm/complete
      hash: md5
      md5: 3f2e570f11b9ecb0b6746806a020da9c.dir
      size: 268841255
      nfiles: 16
    - path: data/ignored.csv
      hash: md5
      md5: cf101b7e87a9ccd5135ff8f846f59302
      size: 9663462
    - path: scripts/ast_export.py
      hash: md5
      md5: 301e377deb0aaf75b1a961a6d91153a8
      size: 11045
    params:
      params.yaml:
        parallel.flags: --verbose
    outs:
    - path: data/ast
      hash: md5
      md5: 7d2fd69dc6c908c0de3ec0403012e448.dir
      size: 91241181
      nfiles: 16
  sppl-import:
    cmd:
    - mkdir -p data/sppl/unmerged
    - "parallel --verbose 'python scripts/sppl_import.py --multi-mix-ast {} --max-number-views
      data/max-number-views.txt --output data/sppl/unmerged/{/.}.json' :::: <(find
      data/ast -type f)"
    deps:
    - path: data/ast
      hash: md5
      md5: 7d2fd69dc6c908c0de3ec0403012e448.dir
      size: 91241181
      nfiles: 16
    - path: data/max-number-views.txt
      hash: md5
      md5: 6512bd43d9caa6e02c990b0a82652dca
      size: 2
    - path: scripts/sppl_import.py
      hash: md5
      md5: 60da181980209f224dd1ed4f8b92c57e
      size: 4743
    params:
      params.yaml:
        parallel.flags: --verbose
    outs:
    - path: data/sppl/unmerged
      hash: md5
      md5: 7628e233b9caa560401068873a61dae4.dir
      size: 73197788
      nfiles: 16
  sppl-merge:
    cmd: "find data/sppl/unmerged -type f | sort | xargs python scripts/sppl_merge.py
      --output data/sppl/merged.json\n"
    deps:
    - path: data/sppl/unmerged
      hash: md5
      md5: 7628e233b9caa560401068873a61dae4.dir
      size: 73197788
      nfiles: 16
    outs:
    - path: data/sppl/merged.json
      hash: md5
      md5: 7e048afe890792b7f7813758320f8c30
      size: 73052412
  sppl-sample:
    cmd: "python scripts/sppl_sample.py --model data/sppl/merged.json --data data/ignored.csv
      > data/synthetic-data-gensql.csv # --sample_count 1000\n"
    deps:
    - path: data/ignored.csv
      hash: md5
      md5: cf101b7e87a9ccd5135ff8f846f59302
      size: 9663462
    - path: data/sppl/merged.json
      hash: md5
      md5: 7e048afe890792b7f7813758320f8c30
      size: 73052412
    - path: scripts/sppl_sample.py
      hash: md5
      md5: 65c711874e0eda0e7d79b4a4a3eb6076
      size: 1843
    outs:
    - path: data/synthetic-data-gensql.csv
      hash: md5
      md5: e7df7b90cf65a0b81cb0cb839c3f9b7e
      size: 15845751
  qc-tag-samples:
    cmd: "clojure -X gensql.structure-learning.qc.samples/tag :data data/ignored.csv
      :samples-synthetic data/synthetic-data-gensql.csv > qc/samples/samples.edn\n"
    deps:
    - path: data/ignored.csv
      hash: md5
      md5: cf101b7e87a9ccd5135ff8f846f59302
      size: 9663462
    - path: data/synthetic-data-gensql.csv
      hash: md5
      md5: e7df7b90cf65a0b81cb0cb839c3f9b7e
      size: 15845751
    - path: src/clojure/gensql/structure_learning/qc/samples.clj
      hash: md5
      md5: e34e26db3736bb02dd084800c9d6af72
      size: 1090
    outs:
    - path: qc/samples/samples.edn
      hash: md5
      md5: 84828fcabdeb1c5f79f150db6e5db1e3
      size: 135688869
  xcat-complete-import:
    cmd:
    - mkdir -p data/xcat/complete/
    - "parallel --verbose 'clojure -X gensql.structure-learning.xcat/import :cgpm-json
      {} :data-csv data/ignored.csv :mapping-table data/mapping-table.edn :numericalized-csv
      data/numericalized.csv :schema-edn data/schema.edn > data/xcat/complete/{/.}.edn'
      :::: <(find data/cgpm/complete -type f)"
    deps:
    - path: data/cgpm/complete
      hash: md5
      md5: 3f2e570f11b9ecb0b6746806a020da9c.dir
      size: 268841255
      nfiles: 16
    - path: data/ignored.csv
      hash: md5
      md5: cf101b7e87a9ccd5135ff8f846f59302
      size: 9663462
    - path: data/mapping-table.edn
      hash: md5
      md5: b63b4188dec52136d47953924a7222e5
      size: 16161
    - path: data/numericalized.csv
      hash: md5
      md5: e76bb612d3cc5e3fe032e38f47126d52
      size: 6570358
    - path: data/schema.edn
      hash: md5
      md5: 5f7ea940bbfc22ead94a9b1a17ff0d82
      size: 3002
    - path: src/clojure/gensql/structure_learning/xcat.clj
      hash: md5
      md5: 50de15b94242c6c71b6822f11cb58771
      size: 4592
    params:
      params.yaml:
        parallel.flags: --verbose
    outs:
    - path: data/xcat/complete/
      hash: md5
      md5: 0cbd2d705421a93d9eb682f3332c2dd9.dir
      size: 1686054202
      nfiles: 16
  xcat-merge:
    cmd: "clj -X gensql.structure-learning.clojurecat/merge :models data/xcat/complete
      :out data/xcat/xcat.merged.edn\n"
    deps:
    - path: data/xcat/complete
      hash: md5
      md5: df77909e8b5b3e94a03c6cea7ef658e2.dir
      size: 339676731
      nfiles: 16
    outs:
    - path: data/xcat/xcat.merged.edn
      hash: md5
      md5: 4657ddce878a3db22723de7dc8e8c2f4
      size: 339676779
  qc-dashboard-spec:
    cmd: "clojure -X gensql.structure-learning.qc.dashboard/spec :samples qc/samples/samples.edn
      :schema data/schema.edn :correlation data/linear-stats.json > qc/specs/qc-dashboard.vl.json\n"
    deps:
    - path: data/linear-stats.json
      hash: md5
      md5: 5e50204f0ed722af479ff9a14d88522f
      size: 690076
    - path: data/schema.edn
      hash: md5
      md5: 5f7ea940bbfc22ead94a9b1a17ff0d82
      size: 3002
    - path: qc/samples/samples.edn
      hash: md5
      md5: 84828fcabdeb1c5f79f150db6e5db1e3
      size: 135688869
    - path: src/clojure/gensql/structure_learning/qc/dashboard.clj
      hash: md5
      md5: 11529f94587a9ade1d3fa4cb84ff0445
      size: 28313
    - path: src/clojure/gensql/structure_learning/qc/util.clj
      hash: md5
      md5: 57e1815724c43afbd84c9414d32a4aee
      size: 4118
    params:
      params.yaml:
        qc.columns:
        - closed
        - prefecture_name
        - seat_capacity
        - all_photo_count
        - genre_first_name
        - total_score
        - review_count
    outs:
    - path: qc/specs/qc-dashboard.vl.json
      hash: md5
      md5: a8b7faa5e7c2d1c1ff8d393fa7d7542b
      size: 154720378
  qc-dashboard-app:
    cmd: "clojure -X gensql.structure-learning.qc.app/create :template qc/templates/index.html
      :spec qc/specs/qc-dashboard.vl.json :renderer canvas :title '\"QC dashboard\"\
      ' > qc/app/qc-dashboard.html\n"
    deps:
    - path: qc/specs/qc-dashboard.vl.json
      hash: md5
      md5: a8b7faa5e7c2d1c1ff8d393fa7d7542b
      size: 154720378
    - path: qc/templates/index.html
      hash: md5
      md5: ac51efb107febc1caf14b5e2c6d0489d
      size: 1685
    - path: src/clojure/gensql/structure_learning/qc/app.clj
      hash: md5
      md5: 4a24b05e49591694f1019ed876596ea6
      size: 519
    outs:
    - path: qc/app/qc-dashboard.html
      hash: md5
      md5: f30f7b7fe5ed16efccbea5ca8ea415a8
      size: 154722052
  qc-splom-spec:
    cmd: "clojure -X gensql.structure-learning.qc.splom/spec :samples qc/samples/samples.edn
      :schema data/schema.edn :correlation data/linear-stats.json > qc/specs/qc-splom.vl.json\n"
    deps:
    - path: data/linear-stats.json
      hash: md5
      md5: 5e50204f0ed722af479ff9a14d88522f
      size: 690076
    - path: data/schema.edn
      hash: md5
      md5: 5f7ea940bbfc22ead94a9b1a17ff0d82
      size: 3002
    - path: qc/samples/samples.edn
      hash: md5
      md5: 84828fcabdeb1c5f79f150db6e5db1e3
      size: 135688869
    - path: src/clojure/gensql/structure_learning/qc/splom.clj
      hash: md5
      md5: a753879cef043c55d23dea202b41abe5
      size: 10862
    - path: src/clojure/gensql/structure_learning/qc/util.clj
      hash: md5
      md5: 57e1815724c43afbd84c9414d32a4aee
      size: 4118
    params:
      params.yaml:
        qc.columns:
        - closed
        - prefecture_name
        - seat_capacity
        - all_photo_count
        - genre_first_name
        - total_score
        - review_count
    outs:
    - path: qc/specs/qc-splom.vl.json
      hash: md5
      md5: 50dc63ace77fc8c4293349806db7bfd5
      size: 154625878
  qc-splom-app:
    cmd: "clojure -X gensql.structure-learning.qc.app/create :template qc/templates/index.html
      :spec qc/specs/qc-splom.vl.json :renderer canvas :title '\"QC scatter plot matrix\"\
      ' > qc/app/qc-splom.html\n"
    deps:
    - path: qc/specs/qc-splom.vl.json
      hash: md5
      md5: 50dc63ace77fc8c4293349806db7bfd5
      size: 154625878
    - path: qc/templates/index.html
      hash: md5
      md5: ac51efb107febc1caf14b5e2c6d0489d
      size: 1685
    - path: src/clojure/gensql/structure_learning/qc/app.clj
      hash: md5
      md5: 4a24b05e49591694f1019ed876596ea6
      size: 519
    outs:
    - path: qc/app/qc-splom.html
      hash: md5
      md5: 20452ce5b5a03b1c7e3f169b656554d1
      size: 154627562
  predict:
    cmd: "python scripts/predict.py --schema data/schema.edn --training data/ignored.csv
      --training data/synthetic-data-gensql.csv --test data/test/test.csv --output
      data/predictions.csv #--test data/test/test-shifted.csv\n"
    deps:
    - path: data/ignored.csv
      hash: md5
      md5: cf101b7e87a9ccd5135ff8f846f59302
      size: 9663462
    - path: data/schema.edn
      hash: md5
      md5: 5f7ea940bbfc22ead94a9b1a17ff0d82
      size: 3002
    - path: data/synthetic-data-gensql.csv
      hash: md5
      md5: e7df7b90cf65a0b81cb0cb839c3f9b7e
      size: 15845751
    - path: data/test/test.csv
      hash: md5
      md5: f49fd3721620bf61b6f70abba8039b3c
      size: 5094258
    - path: scripts/predict.py
      hash: md5
      md5: 9791ef81e7424516b5c452380c448706
      size: 7371
    params:
      params.yaml:
        synthetic_data_evaluation:
          target: closed
          predictor: Random_forest
          datasets:
          - synthetic-data-gensql.csv
          - synthetic-data-gan.csv
          - synthetic-data-copula.csv
    outs:
    - path: data/predictions.csv
      hash: md5
      md5: 5bbe27af5ab5342ef196dbaa0cb55bb2
      size: 805283
  assemble-database:
    cmd: "clojure -M:exec gensql.structure-learning.main assemble-database --table-name
      data --table-path data/nullified.csv --model-name tabelog --model-path data/xcat/xcat.merged.edn
      > data/db.edn\n"
    deps:
    - path: data/cgpm
      hash: md5
      md5: 26d06e02d62f40d9f66cce452801f53f.dir
      size: 135624361
      nfiles: 49
    - path: data/nullified.csv
      hash: md5
      md5: c12c7d4cfad364277d03ab2d6043acd1
      size: 5789945
    - path: data/xcat
      hash: md5
      md5: 9febeb3b3473bbd9cd0f2727753201fb.dir
      size: 679353510
      nfiles: 17
    params:
      params.yaml:
        database.model_name: tabelog
        database.model_path: data/xcat/xcat.merged.edn
        database.table_name: data
        database.table_path: data/nullified.csv
    outs:
    - path: data/db.edn
      hash: md5
      md5: fdf0485d32b413c564f3806cbb66945a
      size: 361214724
  qc-discretize@synthetic-data-gensql.csv:
    cmd: "mkdir -p data/discretized/ && nix develop github:InferenceQL/lpm.discretize
      -c python scripts/discretize.py --real data/ignored.csv --synthetic data/synthetic-data-gensql.csv
      --schema data/loom-schema.json --real-disc data/discretized/ignored.csv --synthetic-disc
      data/discretized/synthetic-data-gensql.csv\n"
    deps:
    - path: data/ignored.csv
      hash: md5
      md5: cf101b7e87a9ccd5135ff8f846f59302
      size: 9663462
    - path: data/loom-schema.json
      hash: md5
      md5: d38348f6d1d1e7a813a68652a21ec350
      size: 2042
    - path: data/synthetic-data-gensql.csv
      hash: md5
      md5: e7df7b90cf65a0b81cb0cb839c3f9b7e
      size: 15845751
    - path: scripts/discretize.py
      hash: md5
      md5: 413bc37503837d33c7f2ae72359e994a
      size: 2033
    outs:
    - path: data/discretized/synthetic-data-gensql.csv
      hash: md5
      md5: dfd5988fa315037fbd1ea70a8fc1672b
      size: 17530147
  qc-fidelity-table@synthetic-data-gensql.csv:
    cmd: "mkdir -p data/fidelity/ && nix develop github:InferenceQL/lpm.fidelity -c
      assess-distance --data-1 data/discretized/ignored.csv --data-2 data/discretized/synthetic-data-gensql.csv
      --bivariate > data/fidelity/synthetic-data-gensql.csv\n"
    deps:
    - path: data/discretized/ignored.csv
      hash: md5
      md5: c46c2a0ef17d44736bf95788a689fa2d
      size: 16062660
    - path: data/discretized/synthetic-data-gensql.csv
      hash: md5
      md5: dfd5988fa315037fbd1ea70a8fc1672b
      size: 17530147
    outs:
    - path: data/fidelity/synthetic-data-gensql.csv
      hash: md5
      md5: 9ed1fa9eece2952117e7fe911b1ad1fd
      size: 217378
  qc-fidelity-json:
    cmd: "python scripts/fidelity2json.py --params params.yaml >> data/fidelity.json\n"
    deps:
    - path: data/fidelity/
      hash: md5
      md5: f3eacd5f9f2985dfcdd247ab59741dae.dir
      size: 644347
      nfiles: 4
    - path: scripts/fidelity2json.py
      hash: md5
      md5: ebe89a5b3530a60999cc3a7c0cfc1493
      size: 860
    params:
      params.yaml:
        synthetic_data_evaluation.datasets:
        - synthetic-data-gensql.csv
        - synthetic-data-gan.csv
        - synthetic-data-copula.csv
    outs:
    - path: data/fidelity.json
      hash: md5
      md5: dc77726f47718d07d4482260618afede
      size: 1374412
  qc-fidelity-app:
    cmd: "awk 'BEGIN {data = ARGV[1]; ARGV[1] = \"\"; while ((getline line < data)
      > 0) data_str = data_str line \"\\n\"} {gsub(\"{{DATA}}\", data_str)} 1' data/fidelity.json
      qc/templates/fidelity.html > qc/app/fidelity.html\n"
    deps:
    - path: data/fidelity.json
      hash: md5
      md5: dc77726f47718d07d4482260618afede
      size: 1374412
    - path: qc/templates/fidelity.html
      hash: md5
      md5: 26cb40e5e0c02c8ca73e3dcdaa21f814
      size: 2037
    outs:
    - path: qc/app/fidelity.html
      hash: md5
      md5: b611d0579a5d64761a8693128ead4a8a
      size: 1376441
  qc-discretize@synthetic-data-gan.csv:
    cmd: "mkdir -p data/discretized/ && nix develop github:InferenceQL/lpm.discretize
      -c python scripts/discretize.py --real data/ignored.csv --synthetic data/synthetic-data-gan.csv
      --schema data/loom-schema.json --real-disc data/discretized/ignored.csv --synthetic-disc
      data/discretized/synthetic-data-gan.csv\n"
    deps:
    - path: data/ignored.csv
      hash: md5
      md5: cf101b7e87a9ccd5135ff8f846f59302
      size: 9663462
    - path: data/loom-schema.json
      hash: md5
      md5: d38348f6d1d1e7a813a68652a21ec350
      size: 2042
    - path: data/synthetic-data-gan.csv
      hash: md5
      md5: 3a7c24c428ecd659e43338ddecbd3dc2
      size: 9627664
    - path: scripts/discretize.py
      hash: md5
      md5: 413bc37503837d33c7f2ae72359e994a
      size: 2033
    outs:
    - path: data/discretized/synthetic-data-gan.csv
      hash: md5
      md5: 14dc70e01596faef79f2c9303a15f6c8
      size: 16221914
  qc-discretize@synthetic-data-copula.csv:
    cmd: "mkdir -p data/discretized/ && nix develop github:InferenceQL/lpm.discretize
      -c python scripts/discretize.py --real data/ignored.csv --synthetic data/synthetic-data-copula.csv
      --schema data/loom-schema.json --real-disc data/discretized/ignored.csv --synthetic-disc
      data/discretized/synthetic-data-copula.csv\n"
    deps:
    - path: data/ignored.csv
      hash: md5
      md5: cf101b7e87a9ccd5135ff8f846f59302
      size: 9663462
    - path: data/loom-schema.json
      hash: md5
      md5: d38348f6d1d1e7a813a68652a21ec350
      size: 2042
    - path: data/synthetic-data-copula.csv
      hash: md5
      md5: 5ada5ea8cfe1fc2e07708ed2e1bdbc16
      size: 9409115
    - path: scripts/discretize.py
      hash: md5
      md5: 413bc37503837d33c7f2ae72359e994a
      size: 2033
    outs:
    - path: data/discretized/synthetic-data-copula.csv
      hash: md5
      md5: 1bb10712625a33bc38af5cce2171ef04
      size: 16007313
  qc-fidelity-table@synthetic-data-gan.csv:
    cmd: "mkdir -p data/fidelity/ && nix develop github:InferenceQL/lpm.fidelity -c
      assess-distance --data-1 data/discretized/ignored.csv --data-2 data/discretized/synthetic-data-gan.csv
      --bivariate > data/fidelity/synthetic-data-gan.csv\n"
    deps:
    - path: data/discretized/ignored.csv
      hash: md5
      md5: c46c2a0ef17d44736bf95788a689fa2d
      size: 16062660
    - path: data/discretized/synthetic-data-gan.csv
      hash: md5
      md5: 14dc70e01596faef79f2c9303a15f6c8
      size: 16221914
    outs:
    - path: data/fidelity/synthetic-data-gan.csv
      hash: md5
      md5: 73015518634586b6831a905637346130
      size: 210189
  qc-fidelity-table@synthetic-data-copula.csv:
    cmd: "mkdir -p data/fidelity/ && nix develop github:InferenceQL/lpm.fidelity -c
      assess-distance --data-1 data/discretized/ignored.csv --data-2 data/discretized/synthetic-data-copula.csv
      --bivariate > data/fidelity/synthetic-data-copula.csv\n"
    deps:
    - path: data/discretized/ignored.csv
      hash: md5
      md5: c46c2a0ef17d44736bf95788a689fa2d
      size: 16062660
    - path: data/discretized/synthetic-data-copula.csv
      hash: md5
      md5: 1bb10712625a33bc38af5cce2171ef04
      size: 16007313
    outs:
    - path: data/fidelity/synthetic-data-copula.csv
      hash: md5
      md5: 4ebe8bd4e359ee511e6608c0ea05f594
      size: 216702
