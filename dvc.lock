schema: '2.0'
stages:
  preprocess:
    cmd: "poetry run preprocess --data data/data.csv --output data/preprocessed.csv
      --column_model_output data/column_models.json --sql \"SELECT * FROM data\"\n"
    deps:
    - path: data/data.csv
      hash: md5
      md5: d857eea6862365fb883c29312e6d5b46
      size: 17933
    outs:
    - path: data/column_models.json
      hash: md5
      md5: d63357a222578d883286d7630fdcaf07
      size: 2531
    - path: data/preprocessed.csv
      hash: md5
      md5: 3925fc60051c23a623f684df372f9663
      size: 1989484
  create-column-models:
    cmd: "poetry run create-column-models --data data/preprocessed.csv --output data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: b853bf59d00f3208387d92747ab15340
      size: 51991
    outs:
    - path: data/column_models.json
      hash: md5
      md5: e8b9c31c41b2cb967afc14be76e6b4d6
      size: 3350
  loom-schema:
    cmd: "poetry run loom_schema --column_models data/column_models.json --output
      data/loom-schema.json\n"
    deps:
    - path: data/column_models.json
      hash: md5
      md5: d63357a222578d883286d7630fdcaf07
      size: 2531
    outs:
    - path: data/loom-schema.json
      hash: md5
      md5: f0cc883d91a6a0e9100c94e157ab02c7
      size: 550
  loom-ingest:
    cmd: ./bin/loom_task ingest loom data/loom-schema.json data/preprocessed.csv
    deps:
    - path: data/loom-schema.json
      hash: md5
      md5: f0cc883d91a6a0e9100c94e157ab02c7
      size: 550
    - path: data/preprocessed.csv
      hash: md5
      md5: 3925fc60051c23a623f684df372f9663
      size: 1989484
    outs:
    - path: loom/ingest
      hash: md5
      md5: 00a3b2ba4a809f48af1ea790bffb1ab3.dir
      size: 418198
      nfiles: 7
    - path: loom/query
      hash: md5
      md5: 077ccbaffe78e4585bd316f1285a0a5c.dir
      size: 106
      nfiles: 1
  loom-infer-config:
    cmd: "yq -o=json '.loom' params.yaml > data/infer-config.json\n"
    outs:
    - path: data/infer-config.json
      hash: md5
      md5: 635e45f25f5910fb341da47f54770bdf
      size: 204
  loom-infer:
    cmd: ./bin/loom_task infer loom 3 data/infer-config.json
    deps:
    - path: data/infer-config.json
      hash: md5
      md5: 635e45f25f5910fb341da47f54770bdf
      size: 204
    - path: loom/ingest
      hash: md5
      md5: 00a3b2ba4a809f48af1ea790bffb1ab3.dir
      size: 418198
      nfiles: 7
    - path: loom/query
      hash: md5
      md5: 077ccbaffe78e4585bd316f1285a0a5c.dir
      size: 106
      nfiles: 1
    params:
      params.yaml:
        sample_count: 3
    outs:
    - path: loom/samples
      hash: md5
      md5: e6143357995d5dfa0dfd24c13f2eef1b.dir
      size: 57249648
      nfiles: 184
  loom-sample:
    cmd: "./bin/loom python scripts/loom_sample.py --sample_count 10000 --output data/synthetic-data-loom.csv\n"
    deps:
    - path: loom/samples
      hash: md5
      md5: e6143357995d5dfa0dfd24c13f2eef1b.dir
      size: 57249648
      nfiles: 184
    - path: scripts/loom_sample.py
      hash: md5
      md5: d6449af8a6b43427f73f6ff14a87aec7
      size: 1290
    outs:
    - path: data/synthetic-data-loom.csv
      hash: md5
      md5: 8af2dd438a073a3989331a83ff89d282
      size: 1906965
  loom-dump-metadata:
    cmd: "find loom/samples -type f ! -name '*.json' | parallel --verbose \"./bin/loom
      python scripts/loom_to_json.py loom_to_json {}\"\n"
    deps:
    - path: loom/samples
      hash: md5
      md5: eda41ef5ea950d8392cd4b1f2643f09f.dir
      size: 1162419
      nfiles: 42
    params:
      params.yaml:
        parallel.flags: --verbose
  loom_to_cgpm:
    cmd: "poetry run loom_to_cgpm --column_model_filename data/column_models.json
      --loom_filename loom/samples/sample.0/model.json\n"
    deps:
    - path: data/column_models.json
      hash: md5
      md5: 586ef82a47f37b4a71cbeee054acccac
      size: 3367
    - path: loom/samples
      hash: md5
      md5: eda41ef5ea950d8392cd4b1f2643f09f.dir
      size: 1162419
      nfiles: 42
  loom-to-json:
    cmd: "find loom/samples -type f ! -name '*.json' | parallel  \"./bin/loom python
      scripts/loom_to_json.py loom_to_json {}\"\n"
    deps:
    - path: loom/samples
      hash: md5
      md5: e6143357995d5dfa0dfd24c13f2eef1b.dir
      size: 57249648
      nfiles: 184
  loom-to-cgpm:
    cmd: "mkdir -p data/cgpm/hydrated && ls loom/samples | parallel  \"poetry run
      loom_to_cgpm --column_model_filename data/column_models.json --data_filename
      data/preprocessed.csv --loom_folder loom/samples/{} --out_filename data/cgpm/hydrated/{}.json\"\
      \n"
    deps:
    - path: data/column_models.json
      hash: md5
      md5: d63357a222578d883286d7630fdcaf07
      size: 2531
    - path: data/preprocessed.csv
      hash: md5
      md5: 3925fc60051c23a623f684df372f9663
      size: 1989484
    - path: loom/samples
      hash: md5
      md5: e6143357995d5dfa0dfd24c13f2eef1b.dir
      size: 57249648
      nfiles: 184
    outs:
    - path: data/cgpm/hydrated
      hash: md5
      md5: 51970748ea798aa23525e1a6003109d2.dir
      size: 11211274
      nfiles: 10
  cgpm-hydrated-sample:
    cmd: "poetry run cgpm-sample --sample_count 10000 --output data/synthetic-data-cgpm-raw.csv
      --model_dir data/cgpm/hydrated --data data/preprocessed.csv\n"
    deps:
    - path: data/cgpm/hydrated
      hash: md5
      md5: 66ac088de57ef99086f016d4404ba7de.dir
      size: 11185489
      nfiles: 10
    outs:
    - path: data/synthetic-data-cgpm-raw.csv
      hash: md5
      md5: df2210c18c98fc74093c77ab102752f8
      size: 2111766
  marginal-fits-cgpm-raw:
    cmd: "mkdir -p qc/marginals && poetry run marginal_fits --real_data data/preprocessed.csv
      --model cgpm-raw --column_models data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: 3925fc60051c23a623f684df372f9663
      size: 1989484
    - path: data/synthetic-data-cgpm-raw.csv
      hash: md5
      md5: df2210c18c98fc74093c77ab102752f8
      size: 2111766
    outs:
    - path: qc/marginals/cgpm-raw_1d_fits.csv
      hash: md5
      md5: e9673048c9e37ae244b2019b4b29d928
      size: 938
    - path: qc/marginals/cgpm-raw_2d_fits.csv
      hash: md5
      md5: 7691e2fd4069db13cef477d2810f27a1
      size: 12666
    - path: qc/marginals/cgpm-raw_worst_1d_fit.html
      hash: md5
      md5: 87e2e54b3f7053abb9b3eed39847de0a
      size: 3646626
    - path: qc/marginals/cgpm-raw_worst_1d_fit.png
      hash: md5
      md5: 3d6e9904aa93c4a0c449f978ed5656e2
      size: 107812
    - path: qc/marginals/cgpm-raw_worst_2d_fit.html
      hash: md5
      md5: 5cb986ce22861cf01f7f426e1a184d76
      size: 3963136
    - path: qc/marginals/cgpm-raw_worst_2d_fit.png
      hash: md5
      md5: a6a5060e3a2fc3248142cb4c9de16511
      size: 82729
  dependence-probability:
    cmd: poetry run dependence-probability --model_dir data/cgpm/hydrated --out_file
      qc/cgpm-hydrated-dependence-probability.csv
    deps:
    - path: data/cgpm/hydrated
      hash: md5
      md5: 66ac088de57ef99086f016d4404ba7de.dir
      size: 11185489
      nfiles: 10
    outs:
    - path: qc/cgpm-hydrated-dependence-probability.csv
      hash: md5
      md5: ee59bfed87067e1bc8fd866fb4be4c7a
      size: 13646
  marginal-fits-cgpm-raw@0:
    cmd: "mkdir -p qc/marginals && poetry run marginal_fits --real_data data/preprocessed.csv
      --model \"cgpm-raw0\"  --column_models data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: 3925fc60051c23a623f684df372f9663
      size: 1989484
    - path: data/synthetic-data-cgpm-raw0.csv
      hash: md5
      md5: 3b7e6e5ab69410c68dc5d13514bf41bc
      size: 2112827
  marginal-fits-cgpm-raw@1:
    cmd: "mkdir -p qc/marginals && poetry run marginal_fits --real_data data/preprocessed.csv
      --model \"cgpm-raw1\"  --column_models data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: 3925fc60051c23a623f684df372f9663
      size: 1989484
    - path: data/synthetic-data-cgpm-raw0.csv
      hash: md5
      md5: 3b7e6e5ab69410c68dc5d13514bf41bc
      size: 2112827
  marginal-fits-cgpm-raw@2:
    cmd: "mkdir -p qc/marginals && poetry run marginal_fits --real_data data/preprocessed.csv
      --model \"cgpm-raw2\"  --column_models data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: 3925fc60051c23a623f684df372f9663
      size: 1989484
    - path: data/synthetic-data-cgpm-raw0.csv
      hash: md5
      md5: 3b7e6e5ab69410c68dc5d13514bf41bc
      size: 2112827
  marginal-fits-cgpm-raw@3:
    cmd: "mkdir -p qc/marginals && poetry run marginal_fits --real_data data/preprocessed.csv
      --model \"cgpm-raw3\"  --column_models data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: 3925fc60051c23a623f684df372f9663
      size: 1989484
    - path: data/synthetic-data-cgpm-raw0.csv
      hash: md5
      md5: 3b7e6e5ab69410c68dc5d13514bf41bc
      size: 2112827
  marginal-fits-cgpm-raw@4:
    cmd: "mkdir -p qc/marginals && poetry run marginal_fits --real_data data/preprocessed.csv
      --model \"cgpm-raw4\"  --column_models data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: 3925fc60051c23a623f684df372f9663
      size: 1989484
    - path: data/synthetic-data-cgpm-raw0.csv
      hash: md5
      md5: 3b7e6e5ab69410c68dc5d13514bf41bc
      size: 2112827
  marginal-fits-cgpm-raw@5:
    cmd: "mkdir -p qc/marginals && poetry run marginal_fits --real_data data/preprocessed.csv
      --model \"cgpm-raw5\"  --column_models data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: 3925fc60051c23a623f684df372f9663
      size: 1989484
    - path: data/synthetic-data-cgpm-raw0.csv
      hash: md5
      md5: 3b7e6e5ab69410c68dc5d13514bf41bc
      size: 2112827
  marginal-fits-cgpm-raw@6:
    cmd: "mkdir -p qc/marginals && poetry run marginal_fits --real_data data/preprocessed.csv
      --model \"cgpm-raw6\"  --column_models data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: 3925fc60051c23a623f684df372f9663
      size: 1989484
    - path: data/synthetic-data-cgpm-raw0.csv
      hash: md5
      md5: 3b7e6e5ab69410c68dc5d13514bf41bc
      size: 2112827
  marginal-fits-cgpm-raw@7:
    cmd: "mkdir -p qc/marginals && poetry run marginal_fits --real_data data/preprocessed.csv
      --model \"cgpm-raw7\"  --column_models data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: 3925fc60051c23a623f684df372f9663
      size: 1989484
    - path: data/synthetic-data-cgpm-raw0.csv
      hash: md5
      md5: 3b7e6e5ab69410c68dc5d13514bf41bc
      size: 2112827
  marginal-fits-cgpm-raw@8:
    cmd: "mkdir -p qc/marginals && poetry run marginal_fits --real_data data/preprocessed.csv
      --model \"cgpm-raw8\"  --column_models data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: 3925fc60051c23a623f684df372f9663
      size: 1989484
    - path: data/synthetic-data-cgpm-raw0.csv
      hash: md5
      md5: 3b7e6e5ab69410c68dc5d13514bf41bc
      size: 2112827
  marginal-fits-cgpm-raw@9:
    cmd: "mkdir -p qc/marginals && poetry run marginal_fits --real_data data/preprocessed.csv
      --model \"cgpm-raw9\"  --column_models data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: 3925fc60051c23a623f684df372f9663
      size: 1989484
    - path: data/synthetic-data-cgpm-raw0.csv
      hash: md5
      md5: 3b7e6e5ab69410c68dc5d13514bf41bc
      size: 2112827
  cgpm-to-sppl:
    cmd: "poetry run cgpm-to-sppl --output data/sppl/merged.json --model_dir data/cgpm/hydrated
      --data data/preprocessed.csv\n"
    deps:
    - path: data/cgpm/hydrated
      hash: md5
      md5: 51970748ea798aa23525e1a6003109d2.dir
      size: 11211274
      nfiles: 10
    outs:
    - path: data/sppl/merged.json
      hash: md5
      md5: 297180e4db2100cb152d1e69634bed0e
      size: 781926
  sample-sppl:
    cmd: "poetry run sample-sppl --sample_count 10000 --output data/synthetic-data-sppl-hydrated.csv
      --model data/sppl/merged.json --data data/preprocessed.csv\n"
    deps:
    - path: data/sppl/merged.json
      hash: md5
      md5: 297180e4db2100cb152d1e69634bed0e
      size: 781926
    outs:
    - path: data/synthetic-data-sppl-hydrated.csv
      hash: md5
      md5: 8d2fd494ad84addadf7281780efef21b
      size: 2111294
  marginal-fits@loom:
    cmd: "poetry run marginal_fits --real_data data/preprocessed.csv --model loom
      --column_models data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: 3925fc60051c23a623f684df372f9663
      size: 1989484
    - path: data/synthetic-data-loom.csv
      hash: md5
      md5: 8af2dd438a073a3989331a83ff89d282
      size: 1906965
    outs:
    - path: qc/marginals/loom_1d_fits.csv
      hash: md5
      md5: 51e0313a764f03559fc51598249a2d2f
      size: 938
    - path: qc/marginals/loom_2d_fits.csv
      hash: md5
      md5: e70c9e676b71da7261c9bd07c74fc321
      size: 12687
    - path: qc/marginals/loom_worst_1d_fit.html
      hash: md5
      md5: c5eb7e9189d33f1ded958c0919310994
      size: 3646360
    - path: qc/marginals/loom_worst_1d_fit.png
      hash: md5
      md5: 335cb5624f6539bdc502a6a7dd7769d2
      size: 112897
    - path: qc/marginals/loom_worst_2d_fit.html
      hash: md5
      md5: 396825ef6dff17caa4cc458764db41d7
      size: 3932177
    - path: qc/marginals/loom_worst_2d_fit.png
      hash: md5
      md5: 406b6189d61eedab7f41cbf1ccf846a3
      size: 77222
  cgpm-sample@hydrated:
    cmd: "poetry run cgpm-sample --sample_count 10000 --output data/synthetic-data-cgpm-hydrated.csv
      --model_dir data/cgpm/hydrated --data data/preprocessed.csv\n"
    deps:
    - path: data/cgpm/hydrated
      hash: md5
      md5: 51970748ea798aa23525e1a6003109d2.dir
      size: 11211274
      nfiles: 10
    outs:
    - path: data/synthetic-data-cgpm-hydrated.csv
      hash: md5
      md5: 974ae56feb143f7088189774c9f1209b
      size: 2113333
  marginal-fits@cgpm-hydrated:
    cmd: "poetry run marginal_fits --real_data data/preprocessed.csv --model cgpm-hydrated
      --column_models data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: 3925fc60051c23a623f684df372f9663
      size: 1989484
    - path: data/synthetic-data-cgpm-hydrated.csv
      hash: md5
      md5: 974ae56feb143f7088189774c9f1209b
      size: 2113333
    outs:
    - path: qc/marginals/cgpm-hydrated_1d_fits.csv
      hash: md5
      md5: 66a19dd0dc421b9b9ed2c2305d6b95f1
      size: 938
    - path: qc/marginals/cgpm-hydrated_2d_fits.csv
      hash: md5
      md5: a3cb46d657351da3f63cd301a007455b
      size: 12688
    - path: qc/marginals/cgpm-hydrated_worst_1d_fit.html
      hash: md5
      md5: c8bbc28c904c2bfde28384200c24d8b4
      size: 3646676
    - path: qc/marginals/cgpm-hydrated_worst_1d_fit.png
      hash: md5
      md5: dc24b5bfb4ebb52cd648dc04c6d88c1a
      size: 108895
    - path: qc/marginals/cgpm-hydrated_worst_2d_fit.html
      hash: md5
      md5: 4e7a7d0ea9d090bc3834be68f9deb49d
      size: 4100156
    - path: qc/marginals/cgpm-hydrated_worst_2d_fit.png
      hash: md5
      md5: 7b21364e9f050cd37d84d430d9fa1dfd
      size: 94315
  marginal-fits@sppl-hydrated:
    cmd: "poetry run marginal_fits --real_data data/preprocessed.csv --model sppl-hydrated
      --column_models data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: 3925fc60051c23a623f684df372f9663
      size: 1989484
    - path: data/synthetic-data-sppl-hydrated.csv
      hash: md5
      md5: 8d2fd494ad84addadf7281780efef21b
      size: 2111294
    outs:
    - path: qc/marginals/sppl-hydrated_1d_fits.csv
      hash: md5
      md5: c65ab006f89e1f30e3d193e7ba2cddcf
      size: 937
    - path: qc/marginals/sppl-hydrated_2d_fits.csv
      hash: md5
      md5: 378dac467777bb968939ad7d3782c196
      size: 12697
    - path: qc/marginals/sppl-hydrated_worst_1d_fit.html
      hash: md5
      md5: 5513138fbd53e8d7d6141ebaedfb6271
      size: 3646534
    - path: qc/marginals/sppl-hydrated_worst_1d_fit.png
      hash: md5
      md5: e7d9a7089d1ffc3edab173e69dfa47fe
      size: 107126
    - path: qc/marginals/sppl-hydrated_worst_2d_fit.html
      hash: md5
      md5: 5cfa4638d65845ac8a9f3b1033e9a8fd
      size: 4099817
    - path: qc/marginals/sppl-hydrated_worst_2d_fit.png
      hash: md5
      md5: 33f8ec1babdcf8fa89f4e5b838b9f082
      size: 93984
  dependence-probability@hydrated:
    cmd: poetry run dependence-probability --model_dir data/cgpm/hydrated --out_file
      qc/cgpm-hydrated-dependence-probability.csv
    deps:
    - path: data/cgpm/hydrated
      hash: md5
      md5: 51970748ea798aa23525e1a6003109d2.dir
      size: 11211274
      nfiles: 10
    outs:
    - path: qc/cgpm-hydrated-dependence-probability.csv
      hash: md5
      md5: 3a3e5ca50453a75c9c686536843aceed
      size: 13647
  regression:
    cmd: "poetry run regression  --data data/preprocessed.csv  --formula \" genetic_recurrence_score
      ~ age.cut([50, 65]) + chemotherapy + progesterone_receptor_status \" --model_filename
      data/sppl/merged.json  --column_model_filename data/column_models.json --result_filename
      data/prediction.csv\n"
