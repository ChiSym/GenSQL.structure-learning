schema: '2.0'
stages:
  preprocess:
    cmd: "poetry run preprocess --data data/data.csv --output data/preprocessed.csv
      --sql \"SELECT Country_of_Operator, Purpose, Perigee_km, Apogee_km, Period_minutes,
      Launch_Mass_kg FROM data LIMIT 1000\"\n"
    deps:
    - path: data/data.csv
      hash: md5
      md5: 2652c974be9aa49bd50061377d39563d
      size: 313452
    outs:
    - path: data/preprocessed.csv
      hash: md5
      md5: b853bf59d00f3208387d92747ab15340
      size: 51991
  create-column-models:
    cmd: "poetry run create-column-models --data data/preprocessed.csv --output data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: b853bf59d00f3208387d92747ab15340
      size: 51991
    outs:
    - path: data/column_models.json
      hash: md5
      md5: e8b9c31c41b2cb967afc14be76e6b4d6
      size: 3350
  loom-schema:
    cmd: "poetry run loom_schema --column_models data/column_models.json --output
      data/loom-schema.json\n"
    deps:
    - path: data/column_models.json
      hash: md5
      md5: e8b9c31c41b2cb967afc14be76e6b4d6
      size: 3350
    outs:
    - path: data/loom-schema.json
      hash: md5
      md5: d63abada5cf9d93e5ae9f9c5b54969e3
      size: 155
  loom-ingest:
    cmd: ./bin/loom_task ingest loom data/loom-schema.json data/preprocessed.csv
    deps:
    - path: data/loom-schema.json
      hash: md5
      md5: d63abada5cf9d93e5ae9f9c5b54969e3
      size: 155
    - path: data/preprocessed.csv
      hash: md5
      md5: b853bf59d00f3208387d92747ab15340
      size: 51991
    outs:
    - path: loom/ingest
      hash: md5
      md5: 3d37d4ab5e03ec81b2dffd98ebf8bfd2.dir
      size: 29364
      nfiles: 7
    - path: loom/query
      hash: md5
      md5: 97fa41fcfcf2150909972ffec14031bd.dir
      size: 106
      nfiles: 1
  loom-infer-config:
    cmd: "yq -o=json '.loom' params.yaml > data/infer-config.json\n"
    outs:
    - path: data/infer-config.json
      hash: md5
      md5: 81a0a13b54820e13a2e5cd28b62e360f
      size: 48
  loom-infer:
    cmd: ./bin/loom_task infer loom 3 data/infer-config.json
    deps:
    - path: data/infer-config.json
      hash: md5
      md5: 81a0a13b54820e13a2e5cd28b62e360f
      size: 48
    - path: loom/ingest
      hash: md5
      md5: 3d37d4ab5e03ec81b2dffd98ebf8bfd2.dir
      size: 29364
      nfiles: 7
    - path: loom/query
      hash: md5
      md5: 97fa41fcfcf2150909972ffec14031bd.dir
      size: 106
      nfiles: 1
    params:
      params.yaml:
        sample_count: 3
    outs:
    - path: loom/samples
      hash: md5
      md5: 1cea69528fe55763bbdd1aaac1bcbeaa.dir
      size: 2769076
      nfiles: 44
  loom-sample:
    cmd: "./bin/loom python scripts/loom_sample.py --sample_count 10000 --output data/synthetic-data-loom.csv\n"
    deps:
    - path: loom/samples
      hash: md5
      md5: 1cea69528fe55763bbdd1aaac1bcbeaa.dir
      size: 2769076
      nfiles: 44
    - path: scripts/loom_sample.py
      hash: md5
      md5: d6449af8a6b43427f73f6ff14a87aec7
      size: 1290
    outs:
    - path: data/synthetic-data-loom.csv
      hash: md5
      md5: 9526a94cc5bd27f24503d5d65d12450c
      size: 811457
  loom-dump-metadata:
    cmd: "find loom/samples -type f ! -name '*.json' | parallel --verbose \"./bin/loom
      python scripts/loom_to_json.py loom_to_json {}\"\n"
    deps:
    - path: loom/samples
      hash: md5
      md5: eda41ef5ea950d8392cd4b1f2643f09f.dir
      size: 1162419
      nfiles: 42
    params:
      params.yaml:
        parallel.flags: --verbose
  loom_to_cgpm:
    cmd: "poetry run loom_to_cgpm --column_model_filename data/column_models.json
      --loom_filename loom/samples/sample.0/model.json\n"
    deps:
    - path: data/column_models.json
      hash: md5
      md5: 586ef82a47f37b4a71cbeee054acccac
      size: 3367
    - path: loom/samples
      hash: md5
      md5: eda41ef5ea950d8392cd4b1f2643f09f.dir
      size: 1162419
      nfiles: 42
  marginal-fits-loom:
    cmd: "mkdir -p qc/marginals && poetry run marginal_fits --real_data data/preprocessed.csv
      --model loom \n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: b853bf59d00f3208387d92747ab15340
      size: 51991
    - path: data/synthetic-data-loom.csv
      hash: md5
      md5: 9526a94cc5bd27f24503d5d65d12450c
      size: 811457
    outs:
    - path: qc/marginals/loom_1d_fits.csv
      hash: md5
      md5: 2039eac75337ff8d37ce9aa0bb96769f
      size: 278
    - path: qc/marginals/loom_2d_fits.csv
      hash: md5
      md5: 3e081993b42193730340dbc6a94c5ad0
      size: 1322
    - path: qc/marginals/loom_worst_1d_fit.html
      hash: md5
      md5: 917a0fc6f2e73494b76e004cff2b1f39
      size: 3710805
    - path: qc/marginals/loom_worst_1d_fit.png
      hash: md5
      md5: ab79b2dee84f9aed45ffe37e5a093079
      size: 137772
    - path: qc/marginals/loom_worst_2d_fit.html
      hash: md5
      md5: e4d4fec85f56b656b646d2489d5239f0
      size: 3948204
    - path: qc/marginals/loom_worst_2d_fit.png
      hash: md5
      md5: 75c4023e6726484009cec5ae1880d5e1
      size: 177800
  loom-to-json:
    cmd: "find loom/samples -type f ! -name '*.json' | parallel --verbose \"./bin/loom
      python scripts/loom_to_json.py loom_to_json {}\"\n"
    deps:
    - path: loom/samples
      hash: md5
      md5: 1cea69528fe55763bbdd1aaac1bcbeaa.dir
      size: 2769076
      nfiles: 44
    params:
      params.yaml:
        parallel.flags: --verbose
  loom-to-cgpm:
    cmd: "mkdir -p data/cgpm/hydrated && ls loom/samples | parallel --verbose \"poetry
      run loom_to_cgpm --column_model_filename data/column_models.json --data_filename
      data/preprocessed.csv --loom_folder loom/samples/{} --out_filename data/cgpm/hydrated/{}.json\"\
      \n"
    deps:
    - path: data/column_models.json
      hash: md5
      md5: e8b9c31c41b2cb967afc14be76e6b4d6
      size: 3350
    - path: data/preprocessed.csv
      hash: md5
      md5: b853bf59d00f3208387d92747ab15340
      size: 51991
    - path: loom/samples
      hash: md5
      md5: 1cea69528fe55763bbdd1aaac1bcbeaa.dir
      size: 2769076
      nfiles: 44
    outs:
    - path: data/cgpm/hydrated
      hash: md5
      md5: 90363602ba0bc01430044dab43e750a9.dir
      size: 94861
      nfiles: 3
  cgpm-hydrated-sample:
    cmd: "poetry run cgpm-sample --sample_count 10000 --output data/synthetic-data-cgpm-raw.csv
      --model_dir data/cgpm/hydrated --data data/preprocessed.csv\n"
    deps:
    - path: data/cgpm/hydrated
      hash: md5
      md5: 90363602ba0bc01430044dab43e750a9.dir
      size: 94861
      nfiles: 3
    outs:
    - path: data/synthetic-data-cgpm-raw.csv
      hash: md5
      md5: ce97720b9e82589cec7bb6be93387f15
      size: 991671
  marginal-fits-cgpm-raw:
    cmd: "mkdir -p qc/marginals && poetry run marginal_fits --real_data data/preprocessed.csv
      --model cgpm-raw \n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: b853bf59d00f3208387d92747ab15340
      size: 51991
    - path: data/synthetic-data-cgpm-raw.csv
      hash: md5
      md5: ce97720b9e82589cec7bb6be93387f15
      size: 991671
    outs:
    - path: qc/marginals/cgpm-raw_1d_fits.csv
      hash: md5
      md5: bbd871231cd82424179ac21a92779b88
      size: 291
    - path: qc/marginals/cgpm-raw_2d_fits.csv
      hash: md5
      md5: fe9ccb613d4aef01680f3f2b35d5b437
      size: 1330
    - path: qc/marginals/cgpm-raw_worst_1d_fit.html
      hash: md5
      md5: 2bb15cc9d4c7a9f73a25701b41f47ac1
      size: 3710774
    - path: qc/marginals/cgpm-raw_worst_1d_fit.png
      hash: md5
      md5: 60f5641e441940ebb18de52c05bd6c32
      size: 137633
    - path: qc/marginals/cgpm-raw_worst_2d_fit.html
      hash: md5
      md5: 0a616dc5255e27eed23cb071809bb091
      size: 3949042
    - path: qc/marginals/cgpm-raw_worst_2d_fit.png
      hash: md5
      md5: 5286b3904dc95cee5ec0f44c185a0224
      size: 177782
