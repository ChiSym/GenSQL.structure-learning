schema: '2.0'
stages:
  preprocess:
    cmd: "poetry run preprocess --data data/data.csv --output data/preprocessed.csv
      --sql \"SELECT * FROM data\"\n"
    deps:
    - path: data/data.csv
      hash: md5
      md5: a8565eae57b403ea5e9ee38aac4265d5
      size: 2004
    outs:
    - path: data/preprocessed.csv
      hash: md5
      md5: a8565eae57b403ea5e9ee38aac4265d5
      size: 2004
  create-column-models:
    cmd: "poetry run create-column-models --data data/preprocessed.csv --output data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: a8565eae57b403ea5e9ee38aac4265d5
      size: 2004
    outs:
    - path: data/column_models.json
      hash: md5
      md5: e540e66b3fc00ee664f3d6fa1ed591c8
      size: 112
  loom-schema:
    cmd: "poetry run loom_schema --column_models data/column_models.json --output
      data/loom-schema.json\n"
    deps:
    - path: data/column_models.json
      hash: md5
      md5: e540e66b3fc00ee664f3d6fa1ed591c8
      size: 112
    outs:
    - path: data/loom-schema.json
      hash: md5
      md5: 6364e710dc06c30b3377a0f662f02d1a
      size: 17
  loom-ingest:
    cmd: ./bin/loom_task ingest loom data/loom-schema.json data/preprocessed.csv
    deps:
    - path: data/loom-schema.json
      hash: md5
      md5: 6364e710dc06c30b3377a0f662f02d1a
      size: 17
    - path: data/preprocessed.csv
      hash: md5
      md5: a8565eae57b403ea5e9ee38aac4265d5
      size: 2004
    outs:
    - path: loom/ingest
      hash: md5
      md5: 63764729f811b1e0a77317cb7ce98a78.dir
      size: 9703
      nfiles: 7
    - path: loom/query
      hash: md5
      md5: 7a655fed8d893274f9ec8f596022204c.dir
      size: 106
      nfiles: 1
  loom-infer-config:
    cmd: "yq -o=json '.loom' params.yaml > data/infer-config.json\n"
    outs:
    - path: data/infer-config.json
      hash: md5
      md5: ff4e2b0904f2d2d14aada40df9fde151
      size: 112
  loom-infer:
    cmd: ./bin/loom_task infer loom 1 data/infer-config.json
    deps:
    - path: data/infer-config.json
      hash: md5
      md5: ff4e2b0904f2d2d14aada40df9fde151
      size: 112
    - path: loom/ingest
      hash: md5
      md5: 63764729f811b1e0a77317cb7ce98a78.dir
      size: 9703
      nfiles: 7
    - path: loom/query
      hash: md5
      md5: 7a655fed8d893274f9ec8f596022204c.dir
      size: 106
      nfiles: 1
    params:
      params.yaml:
        sample_count: 1
    outs:
    - path: loom/samples
      hash: md5
      md5: 6a4ff202c22984992781ed343e18c364.dir
      size: 384031
      nfiles: 7
  loom-sample:
    cmd: "./bin/loom python scripts/loom_sample.py --sample_count 10000 --output data/synthetic-data-loom.csv\n"
    deps:
    - path: loom/samples
      hash: md5
      md5: 6a4ff202c22984992781ed343e18c364.dir
      size: 384031
      nfiles: 7
    - path: scripts/loom_sample.py
      hash: md5
      md5: d6449af8a6b43427f73f6ff14a87aec7
      size: 1290
    outs:
    - path: data/synthetic-data-loom.csv
      hash: md5
      md5: f122dc410b5e38a24e4ef501a14e4942
      size: 20004
  loom-dump-metadata:
    cmd: "find loom/samples -type f ! -name '*.json' | parallel --verbose \"./bin/loom
      python scripts/loom_to_json.py loom_to_json {}\"\n"
    deps:
    - path: loom/samples
      hash: md5
      md5: eda41ef5ea950d8392cd4b1f2643f09f.dir
      size: 1162419
      nfiles: 42
    params:
      params.yaml:
        parallel.flags: --verbose
  loom_to_cgpm:
    cmd: "poetry run loom_to_cgpm --column_model_filename data/column_models.json
      --loom_filename loom/samples/sample.0/model.json\n"
    deps:
    - path: data/column_models.json
      hash: md5
      md5: 586ef82a47f37b4a71cbeee054acccac
      size: 3367
    - path: loom/samples
      hash: md5
      md5: eda41ef5ea950d8392cd4b1f2643f09f.dir
      size: 1162419
      nfiles: 42
  marginal-fits-loom:
    cmd: "mkdir -p qc/marginals && poetry run marginal_fits --real_data data/preprocessed.csv
      --model loom \n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: a8565eae57b403ea5e9ee38aac4265d5
      size: 2004
    - path: data/synthetic-data-loom.csv
      hash: md5
      md5: f122dc410b5e38a24e4ef501a14e4942
      size: 20004
    outs:
    - path: qc/marginals/loom_1d_fits.csv
      hash: md5
      md5: 2921408b6be2d1a0225004aa701bbb5e
      size: 44
    - path: qc/marginals/loom_worst_1d_fit.html
      hash: md5
      md5: 7e3f730fe68848afda2caa43a3a3dd19
      size: 3649683
    - path: qc/marginals/loom_worst_1d_fit.png
      hash: md5
      md5: bf0113b4899aa6ad84069cd73044c509
      size: 173006
  loom-to-json:
    cmd: "find loom/samples -type f ! -name '*.json' | parallel --verbose \"./bin/loom
      python scripts/loom_to_json.py loom_to_json {}\"\n"
    deps:
    - path: loom/samples
      hash: md5
      md5: 240997f5cefa0060c01d540f0200be8c.dir
      size: 648044
      nfiles: 14
    params:
      params.yaml:
        parallel.flags: --verbose
  loom-to-cgpm:
    cmd: "mkdir -p data/cgpm/hydrated && ls loom/samples | parallel --verbose \"poetry
      run loom_to_cgpm --column_model_filename data/column_models.json --data_filename
      data/preprocessed.csv --loom_folder loom/samples/{} --out_filename data/cgpm/hydrated/{}.json\"\
      \n"
    deps:
    - path: data/column_models.json
      hash: md5
      md5: e540e66b3fc00ee664f3d6fa1ed591c8
      size: 112
    - path: data/preprocessed.csv
      hash: md5
      md5: a8565eae57b403ea5e9ee38aac4265d5
      size: 2004
    - path: loom/samples
      hash: md5
      md5: 240997f5cefa0060c01d540f0200be8c.dir
      size: 648044
      nfiles: 14
    outs:
    - path: data/cgpm/hydrated
      hash: md5
      md5: bb58727ed64d16e1d3bc54feff916254.dir
      size: 22331
      nfiles: 1
  cgpm-hydrated-sample:
    cmd: "poetry run cgpm-sample --sample_count 10000 --output data/synthetic-data-cgpm-raw.csv
      --model_dir data/cgpm/hydrated --data data/preprocessed.csv\n"
    deps:
    - path: data/cgpm/hydrated
      hash: md5
      md5: bb58727ed64d16e1d3bc54feff916254.dir
      size: 22331
      nfiles: 1
    outs:
    - path: data/synthetic-data-cgpm-raw.csv
      hash: md5
      md5: 4fc976649fa6099d5498daa5bb5ec11d
      size: 20004
  marginal-fits-cgpm-raw:
    cmd: "mkdir -p qc/marginals && poetry run marginal_fits --real_data data/preprocessed.csv
      --model cgpm-raw \n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: a8565eae57b403ea5e9ee38aac4265d5
      size: 2004
    - path: data/synthetic-data-cgpm-raw.csv
      hash: md5
      md5: 4fc976649fa6099d5498daa5bb5ec11d
      size: 20004
    outs:
    - path: qc/marginals/cgpm-raw_1d_fits.csv
      hash: md5
      md5: 6ca54dd62b8a42b241bf67b0da0cc823
      size: 44
    - path: qc/marginals/cgpm-raw_worst_1d_fit.html
      hash: md5
      md5: 514ad8e5c70861e10fe777b8bd887eee
      size: 3649683
    - path: qc/marginals/cgpm-raw_worst_1d_fit.png
      hash: md5
      md5: b1e8153241729648169eb759ac3b3d34
      size: 172838
  make-synthetic-categorical-data:
    cmd: poetry run make-synthetic-data
    outs:
    - path: data/data.csv
      hash: md5
      md5: a8565eae57b403ea5e9ee38aac4265d5
      size: 2004
