schema: '2.0'
stages:
  preprocess:
    cmd: "poetry run preprocess --data data/data.csv --output data/preprocessed.csv
      --column_model_output data/column_models.json --sql \"SELECT * FROM data\"\n"
    deps:
    - path: data/data.csv
      hash: md5
      md5: d857eea6862365fb883c29312e6d5b46
      size: 17933
    outs:
    - path: data/column_models.json
      hash: md5
      md5: 764b20a03ecf5d62fe51c5abdc6119d3
      size: 907
    - path: data/preprocessed.csv
      hash: md5
      md5: d857eea6862365fb883c29312e6d5b46
      size: 17933
  create-column-models:
    cmd: "poetry run create-column-models --data data/preprocessed.csv --output data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: b853bf59d00f3208387d92747ab15340
      size: 51991
    outs:
    - path: data/column_models.json
      hash: md5
      md5: e8b9c31c41b2cb967afc14be76e6b4d6
      size: 3350
  loom-schema:
    cmd: "poetry run loom_schema --column_models data/column_models.json --output
      data/loom-schema.json\n"
    deps:
    - path: data/column_models.json
      hash: md5
      md5: 764b20a03ecf5d62fe51c5abdc6119d3
      size: 907
    outs:
    - path: data/loom-schema.json
      hash: md5
      md5: 4d9218e76fdf5b43c56b916f20ddf370
      size: 262
  loom-ingest:
    cmd: ./bin/loom_task ingest loom data/loom-schema.json data/preprocessed.csv
    deps:
    - path: data/loom-schema.json
      hash: md5
      md5: 4d9218e76fdf5b43c56b916f20ddf370
      size: 262
    - path: data/preprocessed.csv
      hash: md5
      md5: d857eea6862365fb883c29312e6d5b46
      size: 17933
    outs:
    - path: loom/ingest
      hash: md5
      md5: 8d22ee1d0f0dc0b1d674c57511d953e5.dir
      size: 8748
      nfiles: 7
    - path: loom/query
      hash: md5
      md5: 7bb75ac34da6981520339061464cdc35.dir
      size: 106
      nfiles: 1
  loom-infer-config:
    cmd: "yq -o=json '.loom' params.yaml > data/infer-config.json\n"
    outs:
    - path: data/infer-config.json
      hash: md5
      md5: 7f928ec52cc41312803872ea38fbf3d2
      size: 152
  loom-infer:
    cmd: ./bin/loom_task infer loom 3 data/infer-config.json
    deps:
    - path: data/infer-config.json
      hash: md5
      md5: 7f928ec52cc41312803872ea38fbf3d2
      size: 152
    - path: loom/ingest
      hash: md5
      md5: 8d22ee1d0f0dc0b1d674c57511d953e5.dir
      size: 8748
      nfiles: 7
    - path: loom/query
      hash: md5
      md5: 7bb75ac34da6981520339061464cdc35.dir
      size: 106
      nfiles: 1
    params:
      params.yaml:
        sample_count: 3
    outs:
    - path: loom/samples
      hash: md5
      md5: c291d74ad7b21b96e05f973a2e14445e.dir
      size: 2660305
      nfiles: 48
  loom-sample:
    cmd: "./bin/loom python scripts/loom_sample.py --sample_count 10000 --output data/synthetic-data-loom.csv\n"
    deps:
    - path: loom/samples
      hash: md5
      md5: c291d74ad7b21b96e05f973a2e14445e.dir
      size: 2660305
      nfiles: 48
    - path: scripts/loom_sample.py
      hash: md5
      md5: d6449af8a6b43427f73f6ff14a87aec7
      size: 1290
    outs:
    - path: data/synthetic-data-loom.csv
      hash: md5
      md5: b74e0928bf37d47624e5cd3a2cfda1b1
      size: 1380909
  loom-dump-metadata:
    cmd: "find loom/samples -type f ! -name '*.json' | parallel --verbose \"./bin/loom
      python scripts/loom_to_json.py loom_to_json {}\"\n"
    deps:
    - path: loom/samples
      hash: md5
      md5: eda41ef5ea950d8392cd4b1f2643f09f.dir
      size: 1162419
      nfiles: 42
    params:
      params.yaml:
        parallel.flags: --verbose
  loom_to_cgpm:
    cmd: "poetry run loom_to_cgpm --column_model_filename data/column_models.json
      --loom_filename loom/samples/sample.0/model.json\n"
    deps:
    - path: data/column_models.json
      hash: md5
      md5: 586ef82a47f37b4a71cbeee054acccac
      size: 3367
    - path: loom/samples
      hash: md5
      md5: eda41ef5ea950d8392cd4b1f2643f09f.dir
      size: 1162419
      nfiles: 42
  marginal-fits-loom:
    cmd: "mkdir -p qc/marginals && poetry run marginal_fits --real_data data/preprocessed.csv
      --model loom  --column_models data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: d857eea6862365fb883c29312e6d5b46
      size: 17933
    - path: data/synthetic-data-loom.csv
      hash: md5
      md5: b74e0928bf37d47624e5cd3a2cfda1b1
      size: 1380909
    outs:
    - path: qc/marginals/loom_1d_fits.csv
      hash: md5
      md5: 1e2516c7d9fdc839ae95fdd31caa661f
      size: 370
    - path: qc/marginals/loom_2d_fits.csv
      hash: md5
      md5: 3be3432fee401e7cf62bd06792bf8cb3
      size: 5273
    - path: qc/marginals/loom_worst_1d_fit.html
      hash: md5
      md5: 49b81f3f16c3806c759d2ba2bdccd532
      size: 3645080
    - path: qc/marginals/loom_worst_1d_fit.png
      hash: md5
      md5: 2dc84bb42da0db2015ad6a667dadbc98
      size: 105259
    - path: qc/marginals/loom_worst_2d_fit.html
      hash: md5
      md5: 80f626f444ad32b4b62511cc17d24ff8
      size: 3908531
    - path: qc/marginals/loom_worst_2d_fit.png
      hash: md5
      md5: be50b9d148a9bc317af8b87192ef6c9b
      size: 108240
  loom-to-json:
    cmd: "find loom/samples -type f ! -name '*.json' | parallel  \"./bin/loom python
      scripts/loom_to_json.py loom_to_json {}\"\n"
    deps:
    - path: loom/samples
      hash: md5
      md5: c291d74ad7b21b96e05f973a2e14445e.dir
      size: 2660305
      nfiles: 48
  loom-to-cgpm:
    cmd: "mkdir -p data/cgpm/hydrated && ls loom/samples | parallel  \"poetry run
      loom_to_cgpm --column_model_filename data/column_models.json --data_filename
      data/preprocessed.csv --loom_folder loom/samples/{} --out_filename data/cgpm/hydrated/{}.json\"\
      \n"
    deps:
    - path: data/column_models.json
      hash: md5
      md5: 764b20a03ecf5d62fe51c5abdc6119d3
      size: 907
    - path: data/preprocessed.csv
      hash: md5
      md5: d857eea6862365fb883c29312e6d5b46
      size: 17933
    - path: loom/samples
      hash: md5
      md5: c291d74ad7b21b96e05f973a2e14445e.dir
      size: 2660305
      nfiles: 48
    outs:
    - path: data/cgpm/hydrated
      hash: md5
      md5: 1370954619ac056be3dc8eb235e2cc25.dir
      size: 36691
      nfiles: 3
  cgpm-hydrated-sample:
    cmd: "poetry run cgpm-sample --sample_count 10000 --output data/synthetic-data-cgpm-raw.csv
      --model_dir data/cgpm/hydrated --data data/preprocessed.csv\n"
    deps:
    - path: data/cgpm/hydrated
      hash: md5
      md5: 1370954619ac056be3dc8eb235e2cc25.dir
      size: 36691
      nfiles: 3
    outs:
    - path: data/synthetic-data-cgpm-raw.csv
      hash: md5
      md5: f323af504fbec02331aae3968c9b5077
      size: 1783496
  marginal-fits-cgpm-raw:
    cmd: "mkdir -p qc/marginals && poetry run marginal_fits --real_data data/preprocessed.csv
      --model cgpm-raw  --column_models data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: d857eea6862365fb883c29312e6d5b46
      size: 17933
    - path: data/synthetic-data-cgpm-raw.csv
      hash: md5
      md5: f323af504fbec02331aae3968c9b5077
      size: 1783496
    outs:
    - path: qc/marginals/cgpm-raw_1d_fits.csv
      hash: md5
      md5: 80531f71c000247ba154013be664ee6b
      size: 513
    - path: qc/marginals/cgpm-raw_2d_fits.csv
      hash: md5
      md5: 309664ebf71185174b1b17a5442dfa45
      size: 5498
    - path: qc/marginals/cgpm-raw_worst_1d_fit.html
      hash: md5
      md5: c51c52f2b359482856b3ce7b60e4609f
      size: 3645251
    - path: qc/marginals/cgpm-raw_worst_1d_fit.png
      hash: md5
      md5: e15486c5f10a5ce8d00127632fea7482
      size: 121093
    - path: qc/marginals/cgpm-raw_worst_2d_fit.html
      hash: md5
      md5: cbd870d40381472f07a392071c598d6d
      size: 3999061
    - path: qc/marginals/cgpm-raw_worst_2d_fit.png
      hash: md5
      md5: 0f7d25c40f33e92578e1355b62cd6ac9
      size: 133343
  dependence-probability:
    cmd: poetry run dependence-probability --model_dir data/cgpm/hydrated --out_file
      qc/cgpm-hydrated-dependence-probability.csv
    deps:
    - path: data/cgpm/hydrated
      hash: md5
      md5: 1370954619ac056be3dc8eb235e2cc25.dir
      size: 36691
      nfiles: 3
    outs:
    - path: qc/cgpm-hydrated-dependence-probability.csv
      hash: md5
      md5: 3b4ba33dbad3fba362cc13b2d9081273
      size: 3255
