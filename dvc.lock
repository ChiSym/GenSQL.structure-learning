schema: '2.0'
stages:
  preprocess:
    cmd: "poetry run preprocess --data data/data.csv --output data/preprocessed.csv
      --sql \"$(yq '.sql_preprocessing' params.yaml)\"\n"
    deps:
    - path: data/data.csv
      hash: md5
      md5: 2652c974be9aa49bd50061377d39563d
      size: 313452
    outs:
    - path: data/preprocessed.csv
      hash: md5
      md5: 4c64f4a14418f2b3b5b63ea765853dd6
      size: 37751
  create-column-models:
    cmd: "poetry run create-column-models --data data/preprocessed.csv --output data/column_models.json\n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: 4c64f4a14418f2b3b5b63ea765853dd6
      size: 37751
    outs:
    - path: data/column_models.json
      hash: md5
      md5: 586ef82a47f37b4a71cbeee054acccac
      size: 3367
  loom-schema:
    cmd: "poetry run loom_schema --column_models data/column_models.json --output
      data/loom-schema.json\n"
    deps:
    - path: data/column_models.json
      hash: md5
      md5: 586ef82a47f37b4a71cbeee054acccac
      size: 3367
    outs:
    - path: data/loom-schema.json
      hash: md5
      md5: 21f7715d58f11cf8e5b3aeb56cab6b44
      size: 76
  loom-ingest:
    cmd: ./bin/loom_task ingest loom data/loom-schema.json data/preprocessed.csv
    deps:
    - path: data/loom-schema.json
      hash: md5
      md5: 21f7715d58f11cf8e5b3aeb56cab6b44
      size: 76
    - path: data/preprocessed.csv
      hash: md5
      md5: 4c64f4a14418f2b3b5b63ea765853dd6
      size: 37751
    outs:
    - path: loom/ingest
      hash: md5
      md5: fffeaab63478eb58417415ecd876881c.dir
      size: 20772
      nfiles: 7
    - path: loom/query
      hash: md5
      md5: e2837f7a25ce9fb935338be3f05af3a8.dir
      size: 106
      nfiles: 1
  loom-infer-config:
    cmd: "yq -o=json '.loom' params.yaml > data/infer-config.json\n"
    outs:
    - path: data/infer-config.json
      hash: md5
      md5: 0647407a26e0a99b69a2a99d7636a82a
      size: 46
  loom-infer:
    cmd: ./bin/loom_task infer loom 3 data/infer-config.json
    deps:
    - path: data/infer-config.json
      hash: md5
      md5: 0647407a26e0a99b69a2a99d7636a82a
      size: 46
    - path: loom/ingest
      hash: md5
      md5: fffeaab63478eb58417415ecd876881c.dir
      size: 20772
      nfiles: 7
    - path: loom/query
      hash: md5
      md5: e2837f7a25ce9fb935338be3f05af3a8.dir
      size: 106
      nfiles: 1
    params:
      params.yaml:
        sample_count: 3
    outs:
    - path: loom/samples
      hash: md5
      md5: 274eabf11c21cd3ebecd0edfb2962e68.dir
      size: 54759
      nfiles: 24
  loom-sample:
    cmd: "./bin/loom python scripts/loom_sample.py --sample_count $(yq '.qc.sample_count'
      params.yaml) --output data/synthetic-data-loom.csv\n"
    deps:
    - path: loom/samples
      hash: md5
      md5: 274eabf11c21cd3ebecd0edfb2962e68.dir
      size: 54759
      nfiles: 24
    - path: scripts/loom_sample.py
      hash: md5
      md5: d6449af8a6b43427f73f6ff14a87aec7
      size: 1290
    outs:
    - path: data/synthetic-data-loom.csv
      hash: md5
      md5: 6a82634f8348ce6b3c5bdeab6583ee9a
      size: 44985
  loom-dump-metadata:
    cmd: "find loom/samples -type f ! -name '*.json' | parallel --verbose \"./bin/loom
      python scripts/loom_to_json.py loom_to_json {}\"\n"
    deps:
    - path: loom/samples
      hash: md5
      md5: eda41ef5ea950d8392cd4b1f2643f09f.dir
      size: 1162419
      nfiles: 42
    params:
      params.yaml:
        parallel.flags: --verbose
  loom_to_cgpm:
    cmd: "poetry run loom_to_cgpm --column_model_filename data/column_models.json
      --loom_filename loom/samples/sample.0/model.json\n"
    deps:
    - path: data/column_models.json
      hash: md5
      md5: 586ef82a47f37b4a71cbeee054acccac
      size: 3367
    - path: loom/samples
      hash: md5
      md5: eda41ef5ea950d8392cd4b1f2643f09f.dir
      size: 1162419
      nfiles: 42
  marginal-fits-loom:
    cmd: "mkdir -p qc/marginals && poetry run marginal_fits --real_data data/preprocessed.csv
      --model loom \n"
    deps:
    - path: data/preprocessed.csv
      hash: md5
      md5: 4c64f4a14418f2b3b5b63ea765853dd6
      size: 37751
    - path: data/synthetic-data-loom.csv
      hash: md5
      md5: 6a82634f8348ce6b3c5bdeab6583ee9a
      size: 44985
    outs:
    - path: qc/marginals/loom_1d_fits.csv
      hash: md5
      md5: d96b26db618ffc08d8d1ba14f306e8bb
      size: 155
    - path: qc/marginals/loom_2d_fits.csv
      hash: md5
      md5: 49784e1203683f452ad64daefcd13c55
      size: 281
    - path: qc/marginals/loom_worst_1d_fit.html
      hash: md5
      md5: 70d0782f7ff5e99ce9bb1735b429ec03
      size: 3630830
    - path: qc/marginals/loom_worst_1d_fit.png
      hash: md5
      md5: 33daeed33c6830b0c9be4479d514efb9
      size: 70199
    - path: qc/marginals/loom_worst_2d_fit.html
      hash: md5
      md5: ae9dde148658e521473a30972070345d
      size: 3679753
    - path: qc/marginals/loom_worst_2d_fit.png
      hash: md5
      md5: 385627ad24759ce0230dee430bc892f5
      size: 83539
